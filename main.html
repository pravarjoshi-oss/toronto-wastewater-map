
<!-- ============================================
     FOLLOW YOUR FLUSH - CORE HTML FILE CONTAINING .CSS STYLING and .JS LINKAGE

     Author: Pravar Joshi
     Date:  November 19, 2025
     
     ============================================ -->


<!DOCTYPE html>
<html lang="en">

<!-- ============================================
     HEAD SECTION - Meta Tags & External Resources
     ============================================ -->
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Follow Your Flush: A Science Education Web App Visualizing Toronto’s Wastewater Journey</title>

  <!-- Mapbox GL JS -->
  <script src="https://api.mapbox.com/mapbox-gl-js/v3.4.0/mapbox-gl.js"></script>
  <link href="https://api.mapbox.com/mapbox-gl-js/v3.4.0/mapbox-gl.css" rel="stylesheet" />

  <!-- Turf for spatial operations -->
  <script src="https://cdn.jsdelivr.net/npm/@turf/turf@6/turf.min.js"></script>

  <!-- ============================================
       STYLES SECTION
       ============================================ -->
  <style>

    html, body, #map { height: 100%; margin: 0; }

    /* ==========================================
       PANEL - Info overlay (top-left)
       ========================================== */
    .panel {
      position: absolute; z-index: 2; top: 12px; left: 12px;
      background: rgba(0,0,0,0.6); color: #fff; padding: 12px 14px;
      border-radius: 12px; max-width: 340px; font-size: 14px;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      backdrop-filter: blur(4px);
    }

    /* ==========================================
       CONTROLS - Camera settings (top-right)
       ========================================== */
    .controls {
      position: absolute;
      top: 12px;
      right: 12px;
      z-index: 2;
      width: 230px;
      padding: 14px;
      border-radius: 14px;
      background: rgba(255,255,255,0.92);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      font-size: 13px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.18);
    }

    input[type="range"] {
      width: 100%;
      margin-top: 6px;
      cursor: pointer;
    }

    /* ==========================================
       TREATMENT MODAL - Wastewater treatment information
       ========================================== */
    #treatment-modal {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 20;
    }

    #treatment-backdrop {
      position: absolute;
      inset: 0;
      background: rgba(0,0,0,0.45);
      backdrop-filter: blur(4px);
    }

    #treatment-box {
      position: relative;
      background: white;
      padding: 24px;
      width: 460px;
      max-height: 82vh;
      overflow-y: auto;
      border-radius: 16px;
      animation: fadeIn 0.4s ease-out;
      box-shadow: 0 4px 18px rgba(0,0,0,0.25);
      z-index: 21;
    }

    /* ==========================================
       ANIMATIONS - Keyframes
       ========================================== */
    @keyframes fadeIn {
      from {opacity: 0; transform: scale(0.96);}
      to   {opacity: 1; transform: scale(1);}
    }

    @keyframes introFadeIn {
      from { opacity: 0; transform: translateY(8px) scale(0.97); }
      to   { opacity: 1; transform: translateY(0) scale(1); }
    }

    @keyframes introFadeOut {
      from { opacity: 1; transform: translateY(0) scale(1); }
      to   { opacity: 0; transform: translateY(-6px) scale(0.97); }
    }

    @keyframes fillUp {
      0%   { bottom: -70%; }
      100% { bottom: 0%; }
    }

    @keyframes wave {
      0%   { transform: rotate(0deg); }
      50%  { transform: rotate(4deg); }
      100% { transform: rotate(0deg); }
    }

    @keyframes liquidColorFade {
      0%   { background: #7a4a12; }  /* brown: raw sewage */
      50%  { background: #1b72ff; }  /* blue: treated effluent */
      100% { background: #7a4a12; }  /* back to brown */
    }

    /* ==========================================
       LIQUID ANIMATION - Treatment visualization
       ========================================== */
    .liquid-container {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      margin: 0 auto 16px auto;
      overflow: hidden;
      position: relative;
      border: 3px solid #1b72ff;
    }

    .liquid {
      position: absolute;
      bottom: -70%;
      width: 120%;
      height: 140%;
      border-radius: 40%;
      left: -10%;
      opacity: 0.9;
      animation:
          fillUp 3.5s ease-in-out forwards,
          wave 3s infinite ease-in-out,
          liquidColorFade 6s infinite linear;
    }

    /* ==========================================
       TREATMENT BOX - Text styling
       ========================================== */
    #treatment-box h2 {
      margin-top: 0;
      margin-bottom: 12px;
      text-align: center;
      font-size: 20px;
    }

    #treatment-box h3 {
      margin-bottom: 4px;
      margin-top: 16px;
      font-size: 15px;
    }

    #treatment-box p {
      margin: 0;
      font-size: 13px;
      line-height: 1.4;
    }
  </style>
</head>

<!-- ============================================
     BODY SECTION - HTML Structure
     ============================================ -->
<body>

<!-- ==========================================
     MAP CONTAINER
     ========================================== -->
<div id="map"></div>

<!-- ==========================================
     INTRO MODAL - Welcome screen
     ========================================== -->
<div id="intro-modal"
     style="display:flex; position:fixed; inset:0;
            align-items:center; justify-content:center; z-index:99999;
            background:rgba(0,0,0,0.60); backdrop-filter:blur(7px);">

  <div id="intro-box"
       style="background:white; width:650px; max-width:90%;
              padding:48px 54px;
              border-radius:26px; 
              box-shadow:0 8px 38px rgba(0,0,0,0.45);
              animation:introFadeIn 0.45s ease-out;">

    <h2 style="margin:0 0 22px 0; text-align:center; font-size:32px;">
        Welcome to "Follow Your Flush!"
    </h2>

    <p style="font-size:18px; line-height:1.65; text-align:center; opacity:0.9;">
      Ever wondered what happens after you flush the toilet or run water down the sink?
      This educational app gives you a simple, visual look at where wastewater
      <em>from your home or any other place</em> travels in Toronto.
    </p>

    <p style="font-size:18px; line-height:1.65; text-align:center; margin-top:18px; opacity:0.9;">
      Most of the city is served by <strong>4 major wastewater treatment plants</strong>,
      with a small area handled by Peel Region.
      While the plant boundaries are accurate, the exact underground sewer routes
      are not shown. Toronto has nearly <strong>3800 km of sanitary sewers</strong>
      and more than <strong>523,000 sewer service connections</strong>,
      a complex system to accurately map!
    </p>

    <p style="font-size:18px; line-height:1.65; text-align:center; margin-top:18px; opacity:0.9;">
      Instead, this app uses the <strong>road network as a stand-in</strong> to show a
      simplified path from where you click to the correct treatment plant.
    </p>

    <p style="margin-top:32px; text-align:center; font-size:22px; opacity:0.9;">
        <strong><span style="font-style:italic; color:#1b72ff;">
          Press Enter
        </span></strong>
        to continue and click anywhere on the map to follow your flush!
      </p>

  </div>
</div>

<!-- ==========================================
     CLICK TOOLTIP - Instruction cursor tooltip when user hovers over map
     ========================================== -->
<div id="click-tooltip"
     style="
       position: fixed;
       pointer-events: none;
       z-index: 9999;
       background: rgba(0,0,0,0.75);
       color: #fff;
       padding: 6px 10px;
       font-size: 14px;
       border-radius: 6px;
       opacity: 0;
       transition: opacity 0.25s ease-out;
       font-family: system-ui, sans-serif;
     ">
  Click somewhere in Toronto as the starting point!
</div>

<!-- ==========================================
     INFORMATION PANEL - Data Source  (top-left)
     ========================================== -->
<div class="panel" id="panel">
  <strong>Toronto wastewater path (demo)</strong><br/>
  Click anywhere inside a wastewater catchment area to see an approximate<br/>
  walking-route path your wastewater might take after a flush.<br/><br/>
</div>

<!-- ==========================================
     CONTROLS PANEL - Camera settings (top-right)
     ========================================== -->
<div class="controls">
  <!-- Camera Height Control -->
  <div style="margin-bottom:14px;">
    <label><strong>Camera Height</strong></label>
    <input id="height-slider" type="range" min="150" max="900" value="400" step="10">
    <div style="text-align:right; font-size:12px;">
      <span id="height-value">220 m</span>
    </div>
  </div>

  <!-- Skip Animation Popup -->
  <div id="skip-popup"
       style="
         position:absolute;
         top:160px;
         right:20px;
         background:white;
         padding:10px 14px;
         border-radius:10px;
         box-shadow:0 3px 12px rgba(0,0,0,0.25);
         font-size:13px;
         z-index:30;
         display:none;
         max-width:180px;
         line-height:1.45;
       ">
    Press <strong>Space</strong> any time to skip the animation and go directly to the treatment plant.
  </div>

  <!-- Camera Speed Control -->
  <div style="margin-bottom:10px;">
    <label><strong>Camera Speed</strong></label>
    <input id="speed-slider" type="range" min="15" max="150" value="20" step="5">
    <div style="text-align:right; font-size:12px;">
      <span id="speed-value">100 ms</span>
    </div>
  </div>

</div>

<!-- ==========================================
     TREATMENT MODAL - Wastewater treatment stages
     ========================================== -->
<div id="treatment-modal">
  <div id="treatment-backdrop"></div>

  <div id="treatment-box">
      <!-- Animated liquid visualization -->
      <div class="liquid-container"><div class="liquid"></div></div>

      <h2>Your wastewater receives several stages of treatment and can stay at the plant for up to ~20 days before being safely released!</h2>

      <!-- Treatment stages -->
      <h3>Preliminary Treatment</h3>
      <p>Removes large debris, sand, silt, and non-flushable materials.</p>

      <h3>Primary Treatment</h3>
      <p>Settles out solid organic matter which moves to solids processing.</p>

      <h3>Secondary Treatment</h3>
      <p>Microorganisms break down dissolved pollutants and reduce nutrients.</p>

      <h3>Disinfection</h3>
      <p>Destroys remaining pathogens so effluent can safely return to Lake Ontario.</p>

      <h3>Solids Processing</h3>
      <p>Solids enter heated digesters for 10–20 days, creating methane and biosolids.</p>

      <p style="margin-top:20px; text-align:center; font-size:13px;">
        <strong>Press Space to continue</strong>
      </p>
  </div>
</div>

<!-- ==========================================
     FINAL OUTFALL MODAL - Journey completion
     ========================================== -->
<div id="final-outfall-modal"
     style="display:none; position:fixed; inset:0;
            align-items:center; justify-content:center; z-index:9999;
            background:rgba(0,0,0,0.55); backdrop-filter:blur(4px);">

  <div style="
      background:white; padding:26px 30px; border-radius:16px;
      box-shadow:0 4px 20px rgba(0,0,0,0.35); width:420px;">
      <h2 style="margin-top:0; text-align:center;">Your flush has reached a water body after being treated!</h2>

      <!-- Distance calculation text inserted here -->
      <p id="final-distance-text"
         style="font-size:15px; text-align:center; margin-top:12px;">
      </p>

  </div>
</div>

<!-- ==========================================
     CLICK INFO MODAL - Location & plant info
     ========================================== -->
<div id="click-info-modal" style="display:none; position:fixed; inset:0;
  align-items:center; justify-content:center; z-index:25;">
  <div style="position:absolute; inset:0; background:rgba(0,0,0,0.45); backdrop-filter:blur(4px);"></div>
  <div style="
    position:relative; background:white; padding:22px; width:420px;
    border-radius:16px; box-shadow:0 4px 16px rgba(0,0,0,0.25); z-index:26;
    animation:fadeIn 0.35s ease-out;
  ">
    <p id="clicked-address" style="font-size:14px;"></p>
    <p id="clicked-plant" style="font-size:14px; margin-top:12px;"></p>
    <p style="margin-top:18px; text-align:center; font-size:13px;">
      <strong>Press Enter to start your wastewater journey!</strong>
    </p>
  </div>
</div>

  <!-- Core JavaScript File (MUST BE IN SAME FOLDER AS THIS FILE) -->
  <script src="FollowYourFlush.js"></script>
</body>
</html>

